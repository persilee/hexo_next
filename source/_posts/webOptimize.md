---
title: å‰ç«¯æ€§èƒ½ä¼˜åŒ–
tags:
  - æ€§èƒ½ä¼˜åŒ–
  - web
copyright: true
comments: true
date: 2018-05-10 12:55:59
categories: æ€§èƒ½
top: 107
photos:
---

{% fi https://cdn.lishaoy.net/webOptimize/Optimize.png, web optimize, web optimize %}

å…³äº **æ€§èƒ½ä¼˜åŒ–** æ˜¯ä¸ªå¤§çš„é¢ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ¶‰åŠåˆ° **å‰ç«¯** çš„å‡ ä¸ªç‚¹ï¼Œå¦‚ **å‰ç«¯æ€§èƒ½ä¼˜åŒ–** çš„æµç¨‹ã€å¸¸è§æŠ€æœ¯æ‰‹æ®µã€å·¥å…·ç­‰ã€‚

æåŠ **å‰ç«¯æ€§èƒ½ä¼˜åŒ–** ï¼Œå¤§å®¶åº”è¯¥éƒ½ä¼šæƒ³åˆ° **é›…è™å†›è§„**ï¼Œæœ¬æ–‡ä¼šç»“åˆ **é›…è™å†›è§„** èå…¥è‡ªå·±çš„äº†è§£çŸ¥è¯†ï¼Œè¿›è¡Œçš„æ€»ç»“å’Œæ¢³ç† ğŸ˜œ

<!-- more -->

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ ğŸ‘€ **é›…è™å†›è§„** çš„ **35** æ¡ã€‚

{% note info %} 
1. å°½é‡å‡å°‘ HTTP è¯·æ±‚ä¸ªæ•°â€”â€”é¡»æƒè¡¡
2. ä½¿ç”¨ **CDN**ï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰
3. ä¸ºæ–‡ä»¶å¤´æŒ‡å®š Expires æˆ– Cache-Control ï¼Œä½¿å†…å®¹å…·æœ‰ç¼“å­˜æ€§ã€‚
4. é¿å…ç©ºçš„ src å’Œ href
5. ä½¿ç”¨ gzip å‹ç¼©å†…å®¹
6. æŠŠ CSS æ”¾åˆ°é¡¶éƒ¨
7. æŠŠ JS æ”¾åˆ°åº•éƒ¨
8. é¿å…ä½¿ç”¨ CSS è¡¨è¾¾å¼
9. å°† CSS å’Œ JS æ”¾åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­
10. å‡å°‘ DNS æŸ¥æ‰¾æ¬¡æ•°
11. ç²¾ç®€ CSS å’Œ JS
12. é¿å…è·³è½¬
13. å‰”é™¤é‡å¤çš„ JS å’Œ CSS
14. é…ç½® ETags
15. ä½¿ AJAX å¯ç¼“å­˜
16. å°½æ—©åˆ·æ–°è¾“å‡ºç¼“å†²
17. ä½¿ç”¨ GET æ¥å®Œæˆ AJAX è¯·æ±‚
18. å»¶è¿ŸåŠ è½½
19. é¢„åŠ è½½
20. å‡å°‘ DOM å…ƒç´ ä¸ªæ•°
21. æ ¹æ®åŸŸååˆ’åˆ†é¡µé¢å†…å®¹
22. å°½é‡å‡å°‘ iframe çš„ä¸ªæ•°
23. é¿å… 404
24. å‡å°‘ Cookie çš„å¤§å°
25. ä½¿ç”¨æ—  cookie çš„åŸŸ
26. å‡å°‘ DOM è®¿é—®
27. å¼€å‘æ™ºèƒ½äº‹ä»¶å¤„ç†ç¨‹åº
28. ç”¨ <link> ä»£æ›¿ @import
29. é¿å…ä½¿ç”¨æ»¤é•œ
30. ä¼˜åŒ–å›¾åƒ
31. ä¼˜åŒ– CSS Spirite
32. ä¸è¦åœ¨ HTML ä¸­ç¼©æ”¾å›¾åƒâ€”â€”é¡»æƒè¡¡
33. favicon.icoè¦å°è€Œä¸”å¯ç¼“å­˜
34. ä¿æŒå•ä¸ªå†…å®¹å°äº25K
35. æ‰“åŒ…ç»„ä»¶æˆå¤åˆæ–‡æœ¬
{% endnote %}  

å¦‚å¯¹ **é›…è™å†›è§„** çš„å…·ä½“ç»†åˆ™å†…å®¹ä¸æ˜¯å¾ˆäº†è§£ï¼Œå¯è‡ªè¡Œå»å„æœç´¢ ğŸ” å¼•æ“ ï¼Œæœç´¢ **é›…è™å†›è§„** äº†è§£è¯¦æƒ…ã€‚

## å‹ç¼© åˆå¹¶

å¯¹äº **å‰ç«¯æ€§èƒ½ä¼˜åŒ–** è‡ªç„¶è¦å…³æ³¨ **é¦–å±** æ‰“å¼€é€Ÿåº¦ï¼Œè€Œè¿™ä¸ªé€Ÿåº¦ï¼Œå¾ˆå¤§å› ç´ æ˜¯èŠ±è´¹åœ¨ç½‘ç»œè¯·æ±‚ä¸Šï¼Œé‚£ä¹ˆæ€ä¹ˆå‡å°‘ç½‘ç»œè¯·æ±‚çš„æ—¶é—´å‘¢ï¼Ÿ

- å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•° 
- å‡å°æ–‡ä»¶ä½“ç§¯
- ä½¿ç”¨ `CDN` åŠ é€Ÿ

æ‰€ä»¥ **å‹ç¼©ã€åˆå¹¶** å°±æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå½“ç„¶å¯ä»¥ç”¨ `gulp` ã€ `webpack` ã€ `grunt` ç­‰æ„å»ºå·¥å…· **å‹ç¼©ã€åˆå¹¶**

### `JSã€CSS` å‹ç¼© åˆå¹¶

ä¾‹å¦‚ï¼š`gulp jsã€css` å‹ç¼©ã€åˆå¹¶ä»£ç å¦‚ä¸‹ ğŸ‘‡

```javascript javascript https://lishaoy.net/webOptimize.html#JSã€CSS-å‹ç¼©-åˆå¹¶ gulpfile.js
//å‹ç¼©ã€åˆå¹¶js
gulp.task('scripts', function () {
    return gulp.src([
        './public/lib/fastclick/lib/fastclick.min.js',
        './public/lib/jquery_lazyload/jquery.lazyload.js',
        './public/lib/velocity/velocity.min.js',
        './public/lib/velocity/velocity.ui.min.js',
        './public/lib/fancybox/source/jquery.fancybox.pack.js',
        './public/js/src/utils.js',
        './public/js/src/motion.js',
        './public/js/src/scrollspy.js',
        './public/js/src/post-details.js',
        './public/js/src/bootstrap.js',
        './public/js/src/push.js',
        './public/live2dw/js/perTips.js',
        './public/live2dw/lib/L2Dwidget.min.js',
        './public/js/src/love.js',
        './public/js/src/busuanzi.pure.mini.js',
        './public/js/src/activate-power-mode.js'
    ]).pipe(concat('all.js')).pipe(minify()).pipe(gulp.dest('./public/dist/'));
});

// å‹ç¼©ã€åˆå¹¶ CSS 
gulp.task('css', function () {
    return gulp.src([
        './public/lib/font-awesome/css/font-awesome.min.css',
        './public/lib/fancybox/source/jquery.fancybox.css',
        './public/css/main.css',
        './public/css/lib.css',
        './public/live2dw/css/perTips.css'
    ]).pipe(concat('all.css')).pipe(minify()).pipe(gulp.dest('./public/dist/'));
});
```
ç„¶åï¼Œå†æŠŠ **å‹ç¼©ã€åˆå¹¶** çš„ `JSã€CSS` æ”¾å…¥ `CDN` , ğŸ‘€ çœ‹çœ‹æ•ˆæœå¦‚ä½•

å¦‚å›¾ï¼š* **å‹ç¼©ã€åˆå¹¶** ä¸”æ”¾å…¥ `CND` ä¹‹åçš„æ•ˆæœ *

<img src="https://cdn.lishaoy.net/webOptimize/concatJs.png" alt="é¦–é¡µè¯·æ±‚é€Ÿåº¦(js)" width="100%" title="é¦–é¡µè¯·æ±‚é€Ÿåº¦(js)" align="center" />

<img src="https://cdn.lishaoy.net/webOptimize/concatCss.png" alt="é¦–é¡µè¯·æ±‚é€Ÿåº¦(css)" width="100%" title="é¦–é¡µè¯·æ±‚é€Ÿåº¦(css)" align="center" />

ä»¥ä¸Šæ˜¯ [lishaoy.net](https://lishaoy.net) æ¸…é™¤ç¼“å­˜åçš„ **é¦–é¡µ** è¯·æ±‚é€Ÿåº¦ã€‚

å¯è§ï¼Œè¯·æ±‚æ—¶é—´æ˜¯ **4.59 s** ï¼Œæ€»è¯·æ±‚ä¸ªæ•° **51** ï¼Œ è€Œ `js` çš„è¯·æ±‚ä¸ªæ•°æ˜¯ **8** ï¼Œ`css` çš„è¯·æ±‚ä¸ªæ•°æ˜¯ **3** _ï¼ˆå…¶å®å°± all.css ä¸€ä¸ªï¼Œå…¶å®ƒ 2 ä¸ªæ˜¯ Googleæµè§ˆå™¨åŠ è½½çš„ï¼‰_ï¼Œ è€Œæ²¡ä½¿ç”¨ **å‹ç¼©ã€åˆå¹¶** æ—¶å€™ï¼Œè¯·æ±‚æ—¶é—´æ˜¯ **10** å¤šç§’ï¼Œæ€»è¯·æ±‚ä¸ªæ•°æœ‰ **70** å¤šä¸ªï¼Œ`js` çš„è¯·æ±‚ä¸ªæ•°æ˜¯ **20** å¤šä¸ª ï¼Œå¯¹æ¯”è¯·æ±‚æ—¶é—´ **æ€§èƒ½** æå‡ **1å€** å¤š

å¦‚å›¾ï¼š*æœ‰ç¼“å­˜ä¸‹çš„é¦–é¡µæ•ˆæœ*

<img src="https://cdn.lishaoy.net/webOptimize/concatJs2.png" alt="é¦–é¡µè¯·æ±‚é€Ÿåº¦ï¼ˆç¼“å­˜ï¼‰" width="100%" title="é¦–é¡µè¯·æ±‚é€Ÿåº¦ï¼ˆç¼“å­˜ï¼‰" align="center" />

åŸºæœ¬éƒ½æ˜¯ç§’å¼€ ğŸ˜

{% note warning %}
*Tipsï¼šåœ¨ **å‹ç¼©ã€åˆå¹¶** åï¼Œå•ä¸ªæ–‡ä»¶æ§åˆ¶åœ¨ 25 ~ 30 KBå·¦å³ï¼ŒåŒä¸€ä¸ªåŸŸä¸‹ï¼Œæœ€å¥½ä¸è¦å¤šäº5ä¸ªèµ„æº*
{% endnote %} 

### å›¾ç‰‡å‹ç¼©ã€åˆå¹¶ 

ä¾‹å¦‚ï¼š`gulp` å›¾ç‰‡å‹ç¼©ä»£ç å¦‚ä¸‹ ğŸ‘‡

```javascript javascript https://lishaoy.net/webOptimize.html#å›¾ç‰‡å‹ç¼©ã€åˆå¹¶ gulpfile.js
//å‹ç¼©image
gulp.task('imagemin', function () {
    gulp.src('./public/**/*.{png,jpg,gif,ico,jpeg}')
        .pipe(imagemin())
        .pipe(gulp.dest('./public'));
});
```

å›¾ç‰‡çš„åˆå¹¶å¯ä»¥é‡‡ç”¨ `CSS Spirite`ï¼Œæ–¹æ³•å°±æ˜¯æŠŠä¸€äº›å°å›¾ç”¨ `PS` åˆæˆä¸€å¼ å›¾ï¼Œç”¨ `css` å®šä½æ˜¾ç¤ºæ¯å¼ å›¾ç‰‡çš„ä½ç½®

```css css
.top_right .phone {
	background: url(../images/top_right.png) no-repeat 7px -17px;
	padding: 0 38px;
}

.top_right .help {
	background: url(../images/top_right.png) no-repeat 0 -47px;
	padding: 0 38px;
}
```

ç„¶åï¼ŒæŠŠ **å‹ç¼©** çš„å›¾ç‰‡æ”¾å…¥ `CDN` , ğŸ‘€ çœ‹çœ‹ï¼Œæ•ˆæœå¦‚ä½•

<img src="https://cdn.lishaoy.net/webOptimize/minImages.png" alt="é¦–é¡µè¯·æ±‚é€Ÿåº¦ï¼ˆimagesï¼‰" width="100%" title="é¦–é¡µè¯·æ±‚é€Ÿåº¦ï¼ˆimagesï¼‰" align="center" />

å¯è§ï¼Œè¯·æ±‚æ—¶é—´æ˜¯ **1.70 s** ,æ€»è¯·æ±‚ä¸ªæ•° **50** ï¼Œ è€Œ `img` çš„è¯·æ±‚ä¸ªæ•°æ˜¯ **15** _ï¼ˆè¿™é‡Œå› ä¸ºé¦–é¡µéƒ½æ˜¯å¤§å›¾ï¼Œå°±æ²¡æœ‰åˆå¹¶ï¼Œåªæ˜¯å‹ç¼©äº†ï¼‰_ ï¼Œä½†æ˜¯ï¼Œæ•ˆæœå¾ˆå¥½ ğŸ˜€ ï¼Œä» **4.59 s** ç¼©çŸ­åˆ° **1.70 s**, æ€§èƒ½åˆæå‡ä¸€å€ã€‚

å†çœ‹çœ‹æœ‰ç¼“å­˜æƒ…å†µå¦‚ä½• ğŸ˜

<img src="https://cdn.lishaoy.net/webOptimize/minImages1.png" alt="é¦–é¡µè¯·æ±‚é€Ÿåº¦ï¼ˆimages ç¼“å­˜ï¼‰" width="100%" title="é¦–é¡µè¯·æ±‚é€Ÿåº¦ï¼ˆimages ç¼“å­˜ï¼‰" align="center" />

è¯·æ±‚æ—¶é—´æ˜¯ **1.05 s** ï¼Œæœ‰ç¼“å­˜å’Œæ— ç¼“å­˜åŸºæœ¬å·®ä¸å¤š

{% note warning %}
*Tipsï¼šå¤§çš„å›¾ç‰‡åœ¨ä¸åŒç»ˆç«¯ï¼Œåº”è¯¥ä½¿ç”¨ä¸åŒåˆ†è¾¨ç‡ï¼Œè€Œä¸åº”è¯¥ä½¿ç”¨ç¼©æ”¾ï¼ˆç™¾åˆ†æ¯”ï¼‰*
{% endnote %} 

æ•´ä¸ª **å‹ç¼©ã€åˆå¹¶** _ï¼ˆjsã€cssã€imgï¼‰_ å†æ”¾å…¥ `CDN` ï¼Œè¯·æ±‚æ—¶é—´ä» **10** å¤šç§’ ï¼Œåˆ°æœ€åçš„ **1.70 s** ï¼Œæ€§èƒ½æå‡ **5** å€å¤šï¼Œå¯è§ï¼Œè¿™ä¸ªæ“ä½œå¿…è¦æ€§ã€‚

## ç¼“å­˜

ç¼“å­˜ä¼šæ ¹æ®è¯·æ±‚ä¿å­˜è¾“å‡ºå†…å®¹çš„å‰¯æœ¬ï¼Œä¾‹å¦‚ **é¡µé¢ã€å›¾ç‰‡ã€æ–‡ä»¶**ï¼Œå½“ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥åˆ°çš„æ—¶å€™:å¦‚æœæ˜¯ç›¸åŒçš„`URL`ï¼Œç¼“å­˜ç›´æ¥ä½¿ ç”¨æœ¬åœ°çš„å‰¯æœ¬å“åº”è®¿é—®è¯·æ±‚ï¼Œè€Œä¸æ˜¯å‘æºæœåŠ¡å™¨å†æ¬¡å‘é€è¯·æ±‚ã€‚å› æ­¤ï¼Œå¯ä»¥ä»ä»¥ä¸‹ **2** ä¸ªæ–¹é¢æå‡æ€§èƒ½ã€‚

- å‡å°‘ç›¸åº”å»¶è¿Ÿï¼Œæå‡å“åº”æ—¶é—´
- å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—ï¼ŒèŠ‚çœæµé‡

æˆ‘ä»¬ç”¨ä¸¤å¹…å›¾æ¥äº†è§£ä¸‹æµè§ˆå™¨çš„ **ç¼“å­˜æœºåˆ¶**

**æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚**

![no-shadow](https://cdn.lishaoy.net/webOptimize/webCache3.png "ç¬¬ä¸€æ¬¡è¯·æ±‚")

**æµè§ˆå™¨å†æ¬¡è¯·æ±‚**

![no-shadow](https://cdn.lishaoy.net/webOptimize/webCache4.png "å†æ¬¡è¯·æ±‚")

ä»ä»¥ä¸Šä¸¤å¹…å›¾ä¸­ï¼Œå¯ä»¥æ¸…æ¥šçš„äº†è§£æµè§ˆå™¨ **ç¼“å­˜** çš„è¿‡ç¨‹ã€‚
é¦–æ¬¡è®¿é—®ä¸€ä¸ª `URL` ï¼Œæ²¡æœ‰ **ç¼“å­˜** ï¼Œä½†æ˜¯ï¼ŒæœåŠ¡å™¨ä¼šå“åº”ä¸€äº› `header` ä¿¡æ¯ï¼Œå¦‚ï¼š`expiresã€cache-controlã€last-modifiedã€etag` ç­‰ï¼Œæ¥è®°å½•ä¸‹æ¬¡è¯·æ±‚æ˜¯å¦ç¼“å­˜ã€å¦‚ä½•ç¼“å­˜ã€‚
å†æ¬¡è®¿é—®è¿™ä¸ª `URL` æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®é¦–æ¬¡è®¿é—®è¿”å›çš„ `header` ä¿¡æ¯ï¼Œæ¥å†³ç­–æ˜¯å¦ç¼“å­˜ã€å¦‚ä½•ç¼“å­˜ã€‚
æˆ‘ä»¬é‡ç‚¹æ¥åˆ†æä¸‹ç¬¬äºŒå¹…å›¾ï¼Œå…¶å®æ˜¯åˆ†ä¸¤æ¡çº¿è·¯ï¼Œå¦‚ä¸‹ ğŸ‘‡

- **ç¬¬ä¸€æ¡çº¿è·¯ï¼š** å½“æµè§ˆå™¨å†æ¬¡è®¿é—®æŸä¸ª `URL` æ—¶ï¼Œä¼šå…ˆè·å–èµ„æºçš„ `header` ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦å‘½ä¸­å¼ºç¼“å­˜ _ï¼ˆcache-controlå’Œexpiresï¼‰_ ï¼Œå¦‚å‘½ä¸­ï¼Œç›´æ¥ä»ç¼“å­˜è·å–èµ„æºï¼ŒåŒ…æ‹¬å“åº”çš„ `header` ä¿¡æ¯ _ï¼ˆè¯·æ±‚ä¸ä¼šå’ŒæœåŠ¡å™¨é€šä¿¡ï¼‰_ ï¼Œä¹Ÿå°±æ˜¯ **å¼ºç¼“å­˜** ï¼Œå¦‚å›¾

<img src="https://cdn.lishaoy.net/webOptimize/webCache2.png" alt="å¼ºç¼“å­˜" width="100%" title="å¼ºç¼“å­˜" align="center" />


- **ç¬¬äºŒæ¡çº¿è·¯ï¼š** å¦‚æ²¡æœ‰å‘½ä¸­ **å¼ºç¼“å­˜** ï¼Œæµè§ˆå™¨ä¼šå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œè¯·æ±‚ä¼šæºå¸¦ç¬¬ä¸€æ¬¡è¯·æ±‚è¿”å›çš„æœ‰å…³ç¼“å­˜çš„ `header` ä¿¡æ¯ _ï¼ˆLast-Modified/If-Modified-Sinceå’ŒEtag/If-None-Matchï¼‰_ ï¼Œç”±æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ä¸­çš„ç›¸å…³ `header` ä¿¡æ¯æ¥æ¯”å¯¹ç»“æœæ˜¯å¦åå•†ç¼“å­˜å‘½ä¸­ï¼›è‹¥å‘½ä¸­ï¼Œåˆ™æœåŠ¡å™¨è¿”å›æ–°çš„å“åº” `header` ä¿¡æ¯æ›´æ–°ç¼“å­˜ä¸­çš„å¯¹åº” `header` ä¿¡æ¯ï¼Œä½†æ˜¯å¹¶ä¸è¿”å›èµ„æºå†…å®¹ï¼Œå®ƒä¼šå‘ŠçŸ¥æµè§ˆå™¨å¯ä»¥ç›´æ¥ä»ç¼“å­˜è·å–ï¼›å¦åˆ™è¿”å›æœ€æ–°çš„èµ„æºå†…å®¹ï¼Œä¹Ÿå°±æ˜¯ **åå•†ç¼“å­˜**ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬äº†è§£åˆ°æµè§ˆå™¨ç¼“å­˜æœºåˆ¶åˆ†ä¸º **å¼ºç¼“å­˜ã€åå•†ç¼“å­˜**ï¼Œå†æ¥çœ‹çœ‹ä»–ä»¬çš„åŒºåˆ« ğŸ‘‡

|  ç¼“å­˜ç­–ç•¥   |  è·å–èµ„æºå½¢å¼  |  çŠ¶æ€ç                    |  å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨               |
| :--------: | :----------: | :----------------------: | :--------------------------: |
|  å¼ºç¼“å­˜     | ä»ç¼“å­˜å–      | 200ï¼ˆfrom memory cacheï¼‰  |  å¦ï¼Œç›´æ¥ä»ç¼“å­˜å–               |
|  åå•†ç¼“å­˜   | ä»ç¼“å­˜å–      | 304ï¼ˆnot modifiedï¼‰       |  æ˜¯ï¼Œé€šè¿‡æœåŠ¡å™¨æ¥å‘ŠçŸ¥ç¼“å­˜æ˜¯å¦å¯ç”¨  |

### å¼ºç¼“å­˜

ä¸å¼ºç¼“å­˜ç›¸å…³çš„ `header` å­—æ®µæœ‰ä¸¤ä¸ªï¼š

#### expires

**expiresï¼š** è¿™æ˜¯ `http1.0` æ—¶çš„è§„èŒƒï¼Œå®ƒçš„å€¼ä¸ºä¸€ä¸ªç»å¯¹æ—¶é—´çš„ **GMT** æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œå¦‚ `Mon, 10 Jun 2015 21:31:12 GMT` ï¼Œå¦‚æœå‘é€è¯·æ±‚çš„æ—¶é—´åœ¨ **expires** ä¹‹å‰ï¼Œé‚£ä¹ˆæœ¬åœ°ç¼“å­˜å§‹ç»ˆæœ‰æ•ˆï¼Œå¦åˆ™å°±ä¼šå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨æ¥è·å–èµ„æº

#### cache-control

**cache-control:** `max-age=number` ï¼Œè¿™æ˜¯ `http1.1` æ—¶å‡ºç°çš„ `header` ä¿¡æ¯ï¼Œä¸»è¦æ˜¯åˆ©ç”¨è¯¥å­—æ®µçš„ `max-age` å€¼æ¥è¿›è¡Œåˆ¤æ–­ï¼Œå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹å€¼ï¼›èµ„æºç¬¬ä¸€æ¬¡çš„è¯·æ±‚æ—¶é—´å’Œ **Cache-Control** è®¾å®šçš„æœ‰æ•ˆæœŸï¼Œè®¡ç®—å‡ºä¸€ä¸ªèµ„æºè¿‡æœŸæ—¶é—´ï¼Œå†æ‹¿è¿™ä¸ªè¿‡æœŸæ—¶é—´è·Ÿå½“å‰çš„è¯·æ±‚æ—¶é—´æ¯”è¾ƒï¼Œå¦‚æœè¯·æ±‚æ—¶é—´åœ¨è¿‡æœŸæ—¶é—´ä¹‹å‰ï¼Œå°±èƒ½å‘½ä¸­ç¼“å­˜ï¼Œå¦åˆ™æœªå‘½ä¸­ï¼Œ **cache-control** é™¤äº†è¯¥å­—æ®µå¤–ï¼Œè¿˜æœ‰ä¸‹é¢å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„è®¾ç½®å€¼ï¼š

- **no-cacheï¼š** ä¸ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚éœ€è¦ä½¿ç”¨ç¼“å­˜åå•†ï¼Œå…ˆä¸æœåŠ¡å™¨ç¡®è®¤è¿”å›çš„å“åº”æ˜¯å¦è¢«æ›´æ”¹ï¼Œå¦‚æœä¹‹å‰çš„å“åº”ä¸­å­˜åœ¨ `ETag` ï¼Œé‚£ä¹ˆè¯·æ±‚çš„æ—¶å€™ä¼šä¸æœåŠ¡ç«¯éªŒè¯ï¼Œå¦‚æœèµ„æºæœªè¢«æ›´æ”¹ï¼Œåˆ™å¯ä»¥é¿å…é‡æ–°ä¸‹è½½ã€‚
- **no-storeï¼š** ç›´æ¥ç¦æ­¢æ¸¸è§ˆå™¨ç¼“å­˜æ•°æ®ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¯¥èµ„æºï¼Œéƒ½ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯æ¬¡éƒ½ä¼šä¸‹è½½å®Œæ•´çš„èµ„æºã€‚
- **publicï¼š** å¯ä»¥è¢«æ‰€æœ‰çš„ç”¨æˆ·ç¼“å­˜ï¼ŒåŒ…æ‹¬ç»ˆç«¯ç”¨æˆ·å’Œ `CDN` ç­‰ä¸­é—´ä»£ç†æœåŠ¡å™¨ã€‚
- **privateï¼š** åªèƒ½è¢«ç»ˆç«¯ç”¨æˆ·çš„æµè§ˆå™¨ç¼“å­˜ï¼Œä¸å…è®¸ `CDN` ç­‰ä¸­ç»§ç¼“å­˜æœåŠ¡å™¨å¯¹å…¶ç¼“å­˜ã€‚

{% note warning %}
*Tipsï¼šå¦‚æœ cache-control ä¸ expires åŒæ—¶å­˜åœ¨çš„è¯ï¼Œcache-control çš„ä¼˜å…ˆçº§é«˜äº expires*
{% endnote %} 

### åå•†ç¼“å­˜

åå•†ç¼“å­˜éƒ½æ˜¯ç”±æµè§ˆå™¨å’ŒæœåŠ¡å™¨åå•†ï¼Œæ¥ç¡®å®šæ˜¯å¦ç¼“å­˜ï¼Œåå•†ä¸»è¦é€šè¿‡ä¸‹é¢ä¸¤ç»„ `header` å­—æ®µï¼Œè¿™ä¸¤ç»„å­—æ®µéƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå³ç¬¬ä¸€æ¬¡è¯·æ±‚çš„å“åº”å¤´å¸¦ä¸ŠæŸä¸ªå­—æ®µ _ï¼ˆ **Last-Modified** æˆ–è€… **Etag** ï¼‰_ ï¼Œåˆ™åç»­è¯·æ±‚ä¼šå¸¦ä¸Šå¯¹åº”çš„è¯·æ±‚å­—æ®µ _ï¼ˆ**If-Modified-Since** æˆ–è€… **If-None-Match** ï¼‰_ ï¼Œè‹¥å“åº”å¤´æ²¡æœ‰ **Last-Modified** æˆ–è€… **Etag** å­—æ®µï¼Œåˆ™è¯·æ±‚å¤´ä¹Ÿä¸ä¼šæœ‰å¯¹åº”çš„å­—æ®µã€‚

#### Last-Modified/If-Modified-Since

äºŒè€…çš„å€¼éƒ½æ˜¯ `GMT` æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œå…·ä½“è¿‡ç¨‹ï¼š

- æµè§ˆå™¨ç¬¬ä¸€æ¬¡è·ŸæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªèµ„æºï¼ŒæœåŠ¡å™¨åœ¨è¿”å›è¿™ä¸ªèµ„æºçš„åŒæ—¶ï¼Œåœ¨ `respone` çš„ `header` åŠ ä¸Š **Last-Modified** å­—æ®µï¼Œè¿™ä¸ª `header` å­—æ®µè¡¨ç¤ºè¿™ä¸ªèµ„æºåœ¨æœåŠ¡å™¨ä¸Šçš„æœ€åä¿®æ”¹æ—¶é—´

- æµè§ˆå™¨å†æ¬¡è·ŸæœåŠ¡å™¨è¯·æ±‚è¿™ä¸ªèµ„æºæ—¶ï¼Œåœ¨ `request` çš„ `header` ä¸ŠåŠ ä¸Š **If-Modified-Since** å­—æ®µï¼Œè¿™ä¸ª `header` å­—æ®µçš„å€¼å°±æ˜¯ä¸Šä¸€æ¬¡è¯·æ±‚æ—¶è¿”å›çš„ **Last-Modified** çš„å€¼

- æœåŠ¡å™¨å†æ¬¡æ”¶åˆ°èµ„æºè¯·æ±‚æ—¶ï¼Œæ ¹æ®æµè§ˆå™¨ä¼ è¿‡æ¥ **If-Modified-Since** å’Œèµ„æºåœ¨æœåŠ¡å™¨ä¸Šçš„æœ€åä¿®æ”¹æ—¶é—´åˆ¤æ–­èµ„æºæ˜¯å¦æœ‰å˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–åˆ™è¿”å› `304 Not Modified` ï¼Œä½†æ˜¯ä¸ä¼šè¿”å›èµ„æºå†…å®¹ï¼›å¦‚æœæœ‰å˜åŒ–ï¼Œå°±æ­£å¸¸è¿”å›èµ„æºå†…å®¹ã€‚å½“æœåŠ¡å™¨è¿”å› `304 Not Modified` çš„å“åº”æ—¶ï¼Œ`response header` ä¸­ä¸ä¼šå†æ·»åŠ  **Last-Modifiedçš„header** ï¼Œå› ä¸ºæ—¢ç„¶èµ„æºæ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆ **Last-Modified** ä¹Ÿå°±ä¸ä¼šæ”¹å˜ï¼Œè¿™æ˜¯æœåŠ¡å™¨è¿”å› `304` æ—¶çš„ `response header`

- æµè§ˆå™¨æ”¶åˆ° `304` çš„å“åº”åï¼Œå°±ä¼šä»ç¼“å­˜ä¸­åŠ è½½èµ„æº

- å¦‚æœåå•†ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œæµè§ˆå™¨ç›´æ¥ä»æœåŠ¡å™¨åŠ è½½èµ„æºæ—¶ï¼Œ**Last-Modified** çš„ `Header` åœ¨é‡æ–°åŠ è½½çš„æ—¶å€™ä¼šè¢«æ›´æ–°ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ï¼Œ**If-Modified-Since** ä¼šå¯ç”¨ä¸Šæ¬¡è¿”å›çš„**Last-Modified** å€¼

#### Etag/If-None-Match

è¿™ä¸¤ä¸ªå€¼æ˜¯ç”±æœåŠ¡å™¨ç”Ÿæˆçš„æ¯ä¸ªèµ„æºçš„å”¯ä¸€æ ‡è¯†å­—ç¬¦ä¸²ï¼Œåªè¦èµ„æºæœ‰å˜åŒ–å°±è¿™ä¸ªå€¼å°±ä¼šæ”¹å˜ï¼›å…¶åˆ¤æ–­è¿‡ç¨‹ä¸ **Last-Modifiedã€If-Modified-Since** ç±»ä¼¼ï¼Œä¸ **Last-Modified** ä¸ä¸€æ ·çš„æ˜¯ï¼Œå½“æœåŠ¡å™¨è¿”å› `304 Not Modified` çš„å“åº”æ—¶ï¼Œç”±äº **ETag** é‡æ–°ç”Ÿæˆè¿‡ï¼Œ`response header` ä¸­è¿˜ä¼šæŠŠè¿™ä¸ª **ETag** è¿”å›ï¼Œå³ä½¿è¿™ä¸ª **ETag** è·Ÿä¹‹å‰çš„æ²¡æœ‰å˜åŒ–ã€‚


{% note warning %}
*Tipsï¼šLast-Modifiedä¸ETagæ˜¯å¯ä»¥ä¸€èµ·ä½¿ç”¨çš„ï¼ŒæœåŠ¡å™¨ä¼šä¼˜å…ˆéªŒè¯ETagï¼Œä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šç»§ç»­æ¯”å¯¹Last-Modifiedï¼Œæœ€åæ‰å†³å®šæ˜¯å¦è¿”å›304ã€‚*
{% endnote %} 

### Service Worker

#### ä»€ä¹ˆæ˜¯ Service Worker
{% blockquote Service Worker API http://sethgodin.typepad.com/seths_blog/2009/07/welcome-to-island-marketing.html developer.mozilla.org %} 
**Service Worker** æœ¬è´¨ä¸Šå……å½“Webåº”ç”¨ç¨‹åºä¸æµè§ˆå™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç½‘ç»œå¯ç”¨æ—¶ä½œä¸ºæµè§ˆå™¨å’Œç½‘ç»œé—´çš„ä»£ç†ã€‚å®ƒä»¬æ—¨åœ¨ï¼ˆé™¤å…¶ä»–ä¹‹å¤–ï¼‰ä½¿å¾—èƒ½å¤Ÿåˆ›å»ºæœ‰æ•ˆçš„ç¦»çº¿ä½“éªŒï¼Œæ‹¦æˆªç½‘ç»œè¯·æ±‚å¹¶åŸºäºç½‘ç»œæ˜¯å¦å¯ç”¨ä»¥åŠæ›´æ–°çš„èµ„æºæ˜¯å¦é©»ç•™åœ¨æœåŠ¡å™¨ä¸Šæ¥é‡‡å–é€‚å½“çš„åŠ¨ä½œã€‚ä»–ä»¬è¿˜å…è®¸è®¿é—®æ¨é€é€šçŸ¥å’Œåå°åŒæ­¥APIã€‚
{% endblockquote %}<br>
**Service worker** å¯ä»¥è§£å†³ç›®å‰ç¦»çº¿åº”ç”¨çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åšæ›´å¤šçš„äº‹ã€‚ **Service Worker** å¯ä»¥ä½¿ä½ çš„åº”ç”¨å…ˆè®¿é—®æœ¬åœ°ç¼“å­˜èµ„æºï¼Œæ‰€ä»¥åœ¨ç¦»çº¿çŠ¶æ€æ—¶ï¼Œåœ¨æ²¡æœ‰é€šè¿‡ç½‘ç»œæ¥æ”¶åˆ°æ›´å¤šçš„æ•°æ®å‰ï¼Œä»å¯ä»¥æä¾›åŸºæœ¬çš„åŠŸèƒ½ï¼ˆä¸€èˆ¬ç§°ä¹‹ä¸º Offline Firstï¼‰ã€‚è¿™æ˜¯åŸç”ŸAPP æœ¬æ¥å°±æ”¯æŒçš„åŠŸèƒ½ï¼Œè¿™ä¹Ÿæ˜¯ç›¸æ¯”äº `web app` ï¼ŒåŸç”Ÿ `app` æ›´å—é’ççš„ä¸»è¦åŸå› ã€‚

å†æ¥çœ‹çœ‹ ğŸ‘€ **service worker** èƒ½åšäº›ä»€ä¹ˆï¼š

- åå°æ¶ˆæ¯ä¼ é€’
- ç½‘ç»œä»£ç†ï¼Œè½¬å‘è¯·æ±‚ï¼Œä¼ªé€ å“åº”
- ç¦»çº¿ç¼“å­˜
- æ¶ˆæ¯æ¨é€
-  â€¦ â€¦
{% note success %} 
***æœ¬æ–‡ä¸»è¦ä»¥ï¼ˆ[lishaoy.net](https://lishaoy.net)ï¼‰èµ„æºç¼“å­˜ä¸ºä¾‹,é˜è¿°ä¸‹ service workerå¦‚ä½•å·¥ä½œ***
{% endnote %}  

#### ç”Ÿå‘½å‘¨æœŸ

**service worker** åˆæ¬¡å®‰è£…çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚å›¾ ğŸŒ 

![no-shadow](https://cdn.lishaoy.net/webOptimize/serviceWorker.png "swç”Ÿå‘½å‘¨æœŸ")

ä»ä¸Š ğŸ‘† å›¾å¯çŸ¥ï¼Œ**service worker** å·¥ä½œçš„æµç¨‹ï¼š
1. **å®‰è£…ï¼š**  `service worker URL` é€šè¿‡ `serviceWorkerContainer.register()` æ¥è·å–å’Œæ³¨å†Œã€‚
2. **æ¿€æ´»ï¼š** å½“ `service worker` å®‰è£…å®Œæˆåï¼Œä¼šæ¥æ”¶åˆ°ä¸€ä¸ªæ¿€æ´»äº‹ä»¶(activate event)ã€‚ `onactivate` ä¸»è¦ç”¨é€”æ˜¯æ¸…ç†å…ˆå‰ç‰ˆæœ¬çš„ `service worker` è„šæœ¬ä¸­ä½¿ç”¨çš„èµ„æºã€‚
3. **ç›‘å¬ï¼š** ä¸¤ç§çŠ¶æ€
    - ç»ˆæ­¢ä»¥èŠ‚çœå†…å­˜ï¼›
    - ç›‘å¬è·å– `fetch` å’Œæ¶ˆæ¯ `message` äº‹ä»¶ã€‚
4. **é”€æ¯ï¼š** æ˜¯å¦é”€æ¯ç”±æµè§ˆå™¨å†³å®šï¼Œå¦‚æœä¸€ä¸ª `service worker` é•¿æœŸä¸ä½¿ç”¨æˆ–è€…æœºå™¨å†…å­˜æœ‰é™ï¼Œåˆ™å¯èƒ½ä¼šé”€æ¯è¿™ä¸ª `worker` ã€‚

{% note warning %}
*Tipsï¼šæ¿€æ´»æˆåŠŸä¹‹åï¼Œåœ¨ Chrome æµè§ˆå™¨é‡Œï¼Œå¯ä»¥è®¿é—® chrome://inspect/#service-workerså’Œ chrome://serviceworker-internals/ å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰è¿è¡Œçš„service worker ï¼Œå¦‚å›¾ ğŸ‘‡ã€‚*
{% endnote %} 
<img src="https://cdn.lishaoy.net/webOptimize/serviceWorker1.png" alt="service worker" width="100%" title="service worker" align="center" />

**ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å†™ä¸ªç®€å•çš„ä¾‹å­ ğŸŒ° **

#### æ³¨å†Œ service worker

è¦å®‰è£… `service worker` ï¼Œä½ éœ€è¦åœ¨ä½ çš„é¡µé¢ä¸Šæ³¨å†Œå®ƒã€‚è¿™ä¸ªæ­¥éª¤å‘Šè¯‰æµè§ˆå™¨ä½ çš„ `service worker` è„šæœ¬åœ¨å“ªé‡Œã€‚

```javascript javascript https://lishaoy.net/webOptimize.html#æ³¨å†Œ-service-worker app.js
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').then(function(registration) {
    // Registration was successful
    console.log('ServiceWorker registration successful with scope: ',    registration.scope);
  }).catch(function(err) {
    // registration failed :(
    console.log('ServiceWorker registration failed: ', err);
  });
}
```

ä¸Šé¢çš„ä»£ç æ£€æŸ¥ `service worker API` æ˜¯å¦å¯ç”¨ï¼Œå¦‚æœå¯ç”¨ï¼Œ`service worker /sw.js` è¢«æ³¨å†Œã€‚å¦‚æœè¿™ä¸ª `service worker` å·²ç»è¢«æ³¨å†Œè¿‡ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¿½ç•¥ä¸Šé¢çš„ä»£ç ã€‚

#### æ¿€æ´» service worker

åœ¨ä½ çš„ `service worker` æ³¨å†Œä¹‹åï¼Œæµè§ˆå™¨ä¼šå°è¯•ä¸ºä½ çš„é¡µé¢æˆ–ç«™ç‚¹å®‰è£…å¹¶æ¿€æ´»å®ƒã€‚ 
`install` äº‹ä»¶ä¼šåœ¨å®‰è£…å®Œæˆä¹‹åè§¦å‘ã€‚`install` äº‹ä»¶ä¸€èˆ¬æ˜¯è¢«ç”¨æ¥å¡«å……ä½ çš„æµè§ˆå™¨çš„ç¦»çº¿ç¼“å­˜èƒ½åŠ›ã€‚ä½ éœ€è¦ä¸º `install` äº‹ä»¶å®šä¹‰ä¸€ä¸ª `callback` ï¼Œå¹¶å†³å®šå“ªäº›æ–‡ä»¶ä½ æƒ³è¦ç¼“å­˜.

```javascript javascript https://lishaoy.net/webOptimize.html#æ¿€æ´»-service-worker sw.js
// The files we want to cache
var CACHE_NAME = 'my-site-cache-v1';
var urlsToCache = [
  '/',
  '/css/main.css',
  '/js/main.js'
];

self.addEventListener('install', function(event) {
  // Perform install steps
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(function(cache) {
        console.log('Opened cache');
        return cache.addAll(urlsToCache);
      })
  );
});
```

åœ¨æˆ‘ä»¬çš„ `install callback` ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
- å¼€å¯ä¸€ä¸ªç¼“å­˜
- ç¼“å­˜æˆ‘ä»¬çš„æ–‡ä»¶
- å†³å®šæ˜¯å¦æ‰€æœ‰çš„èµ„æºæ˜¯å¦è¦è¢«ç¼“å­˜

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ `caches.open` æ‰“å¼€æˆ‘ä»¬æŒ‡å®šçš„ `cache` æ–‡ä»¶åï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨ `cache.addAll` å¹¶ä¼ å…¥æˆ‘ä»¬çš„æ–‡ä»¶æ•°ç»„ã€‚è¿™æ˜¯é€šè¿‡ä¸€è¿ä¸² `promise` _ï¼ˆcaches.open å’Œ cache.addAllï¼‰_ å®Œæˆçš„ã€‚`event.waitUntil` æ‹¿åˆ°ä¸€ä¸ª `promise` å¹¶ä½¿ç”¨å®ƒæ¥è·å¾—å®‰è£…è€—è´¹çš„æ—¶é—´ä»¥åŠæ˜¯å¦å®‰è£…æˆåŠŸã€‚

#### ç›‘å¬ service worker

ç°åœ¨æˆ‘ä»¬å·²ç»å°†ä½ çš„ç«™ç‚¹èµ„æºç¼“å­˜äº†ï¼Œä½ éœ€è¦å‘Šè¯‰ `service worker` è®©å®ƒç”¨è¿™äº›ç¼“å­˜å†…å®¹æ¥åšç‚¹ä»€ä¹ˆã€‚æœ‰äº† `fetch` äº‹ä»¶ï¼Œè¿™æ˜¯å¾ˆå®¹æ˜“åšåˆ°çš„ã€‚

æ¯æ¬¡ä»»ä½•è¢« `service worker` æ§åˆ¶çš„èµ„æºè¢«è¯·æ±‚åˆ°æ—¶ï¼Œéƒ½ä¼šè§¦å‘ `fetch` äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ `service worker` æ·»åŠ ä¸€ä¸ª `fetch` çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œæ¥ç€è°ƒç”¨ `event` ä¸Šçš„ `respondWith()` æ–¹æ³•æ¥åŠ«æŒæˆ‘ä»¬çš„ **HTTP** å“åº”ï¼Œç„¶åä½ ç”¨å¯ä»¥ç”¨è‡ªå·±çš„æ–¹æ³•æ¥æ›´æ–°ä»–ä»¬ã€‚

```javascript javascript https://lishaoy.net/webOptimize.html#ç›‘å¬-service-worker sw.js
self.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.match(event.request);
  );
});
```

`caches.match(event.request)` å…è®¸æˆ‘ä»¬å¯¹ç½‘ç»œè¯·æ±‚çš„èµ„æºå’Œ `cache` é‡Œå¯è·å–çš„èµ„æºè¿›è¡ŒåŒ¹é…ï¼ŒæŸ¥çœ‹æ˜¯å¦ç¼“å­˜ä¸­æœ‰ç›¸åº”çš„èµ„æºã€‚è¿™ä¸ªåŒ¹é…é€šè¿‡ `url` å’Œ `vary header` è¿›è¡Œï¼Œå°±åƒæ­£å¸¸çš„ **HTTP** è¯·æ±‚ä¸€æ ·ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è¿”å› `request` å‘¢ï¼Œä¸‹é¢ ğŸ‘‡ å°±æ˜¯ä¸€ä¸ªä¾‹å­ ğŸŒ°

```javascript javascript https://lishaoy.net/webOptimize.html#ç›‘å¬-service-worker sw.js
self.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.match(event.request)
      .then(function(response) {
        // Cache hit - return response
        if (response) {
          return response;
        }

        return fetch(event.request);
      }
    )
  );
});
```
ä¸Šé¢çš„ä»£ç é‡Œæˆ‘ä»¬å®šä¹‰äº† `fetch` äº‹ä»¶ï¼Œåœ¨ `event.respondWith` é‡Œï¼Œæˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ªç”± `caches.match` äº§ç”Ÿçš„ `promise.caches.match` æŸ¥æ‰¾ `request` ä¸­è¢« `service worker` ç¼“å­˜å‘½ä¸­çš„ `response` ã€‚
å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå‘½ä¸­çš„ `response` ï¼Œæˆ‘ä»¬è¿”å›è¢«ç¼“å­˜çš„å€¼ï¼Œå¦åˆ™æˆ‘ä»¬è¿”å›ä¸€ä¸ªå®æ—¶ä»ç½‘ç»œè¯·æ±‚ `fetch` çš„ç»“æœã€‚

#### sw-toolbox

{% note success %}
*å½“ç„¶ï¼Œæˆ‘ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ï¼š[lishaoy.net](https://lishaoy.net) ä½¿ç”¨äº† **sw-toolbox**ã€‚*
{% endnote  %}

**sw-toolbox** ä½¿ç”¨éå¸¸ç®€å•ï¼Œä¸‹é¢ ğŸ‘‡ å°±æ˜¯ [lishaoy.net](https://lishaoy.net) çš„ä¸€ä¸ªä¾‹å­ ğŸŒ°

```javascript javascript https://lishaoy.net/webOptimize.html#sw-toolbox persilee.js
  "serviceWorker" in navigator ? navigator.serviceWorker.register('/sw.js').then(function () {
    navigator.serviceWorker.controller ? console.log("Assets cached by the controlling service worker.") : console.log("Please reload this page to allow the service worker to handle network operations.")
  }).catch(function (e) {
    console.log("ERROR: " + e)
  }) : console.log("Service workers are not supported in the current browser.")
```

ä»¥ä¸Šæ˜¯ **æ³¨å†Œ** ä¸€ä¸ª `service woker`

```javascript javascript https://lishaoy.net/webOptimize.html#sw-toolbox sw.js
"use strict";
(function () {
    var cacheVersion = "20180527";
    var staticImageCacheName = "image" + cacheVersion;
    var staticAssetsCacheName = "assets" + cacheVersion;
    var contentCacheName = "content" + cacheVersion;
    var vendorCacheName = "vendor" + cacheVersion;
    var maxEntries = 100;
    self.importScripts("/lib/sw-toolbox/sw-toolbox.js");
    self.toolbox.options.debug = false;
    self.toolbox.options.networkTimeoutSeconds = 3;

    self.toolbox.router.get("/images/(.*)", self.toolbox.cacheFirst, {
        cache: {
            name: staticImageCacheName,
            maxEntries: maxEntries
        }
    });

    self.toolbox.router.get('/js/(.*)', self.toolbox.cacheFirst, {
        cache: {
            name: staticAssetsCacheName,
            maxEntries: maxEntries
        }
    });
    self.toolbox.router.get('/css/(.*)', self.toolbox.cacheFirst, {
        cache: {
            name: staticAssetsCacheName,
            maxEntries: maxEntries
        }
    
    ......

    self.addEventListener("install", function (event) {
        return event.waitUntil(self.skipWaiting())
    });
    self.addEventListener("activate", function (event) {
        return event.waitUntil(self.clients.claim())
    })
})();
```
å°±è¿™æ ·æå®šäº† ğŸ‰ _(å…·ä½“çš„ç”¨æ³•å¯ä»¥å» [sw-toolbox](https://googlechromelabs.github.io/sw-toolbox/api.html#main) æŸ¥çœ‹)_

æœ€åï¼Œæ¥ä¸¤å¼ å›¾ 

<img src="https://cdn.lishaoy.net/webOptimize/serviceWorker2.png" alt="from ServiceWorker" width="100%" title="from ServiceWorker" align="center" />

<img src="https://cdn.lishaoy.net/webOptimize/serviceWorker3.png" alt="Cache Storage" width="100%" title="Cache Storage" align="center" />

## æœªå®Œï¼Œå¾…ç»­ã€‚ã€‚ã€‚ ğŸ˜œ
